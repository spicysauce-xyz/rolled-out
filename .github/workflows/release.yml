name: Release Application

on:
  workflow_call:
    secrets:
      DEPLOYMENT_API_KEY:
        required: true
      DEPLOYMENT_URL:
        required: true
      DEPLOYMENT_DATABASE_ID:
        required: true
      DEPLOYMENT_API_ID:
        required: true
      DEPLOYMENT_WEB_ID:
        required: true
      DEPLOYMENT_HOCUS_ID:
        required: true
      DEPLOYMENT_PUBLIC_ID:
        required: true
      DEPLOYMENT_MARKETING_ID:
        required: true

jobs:
  execute:
    runs-on: ubuntu-latest

    steps:
      - name: Deploy Database
        run: |
            curl -X 'POST' \
            '${{ secrets.DEPLOYMENT_URL }}/api/trpc/application.deploy' \
            -H 'accept: application/json' \
            -H 'x-api-key: ${{ secrets.DEPLOYMENT_API_KEY }}' \
            -H 'Content-Type: application/json' \
            -d '{
                "json":{
                    "applicationId": "${{ secrets.DEPLOYMENT_DATABASE_ID }}"
                }
            }'

      - name: Deploy API
        run: |
            curl -X 'POST' \
            '${{ secrets.DEPLOYMENT_URL }}/api/trpc/application.deploy' \
            -H 'accept: application/json' \
            -H 'x-api-key: ${{ secrets.DEPLOYMENT_API_KEY }}' \
            -H 'Content-Type: application/json' \
            -d '{
                "json":{
                    "applicationId": "${{ secrets.DEPLOYMENT_API_ID }}"
                }
            }'

      - name: Deploy Web
        run: |
            curl -X 'POST' \
            '${{ secrets.DEPLOYMENT_URL }}/api/trpc/application.deploy' \
            -H 'accept: application/json' \
            -H 'x-api-key: ${{ secrets.DEPLOYMENT_API_KEY }}' \
            -H 'Content-Type: application/json' \
            -d '{
                "json":{
                    "applicationId": "${{ secrets.DEPLOYMENT_WEB_ID }}"
                }
            }'

      - name: Deploy Hocus
        run: |
            curl -X 'POST' \
            '${{ secrets.DEPLOYMENT_URL }}/api/trpc/application.deploy' \
            -H 'accept: application/json' \
            -H 'x-api-key: ${{ secrets.DEPLOYMENT_API_KEY }}' \
            -H 'Content-Type: application/json' \
            -d '{
                "json":{
                    "applicationId": "${{ secrets.DEPLOYMENT_HOCUS_ID }}"
                }
            }'

      - name: Deploy Public
        run: |
            curl -X 'POST' \
            '${{ secrets.DEPLOYMENT_URL }}/api/trpc/application.deploy' \
            -H 'accept: application/json' \
            -H 'x-api-key: ${{ secrets.DEPLOYMENT_API_KEY }}' \
            -H 'Content-Type: application/json' \
            -d '{
                "json":{
                    "applicationId": "${{ secrets.DEPLOYMENT_PUBLIC_ID }}"
                }
            }'

      - name: Deploy Marketing
        run: |
            curl -X 'POST' \
            '${{ secrets.DEPLOYMENT_URL }}/api/trpc/application.deploy' \
            -H 'accept: application/json' \
            -H 'x-api-key: ${{ secrets.DEPLOYMENT_API_KEY }}' \
            -H 'Content-Type: application/json' \
            -d '{
                "json":{
                    "applicationId": "${{ secrets.DEPLOYMENT_MARKETING_ID }}"
                }
            }'
